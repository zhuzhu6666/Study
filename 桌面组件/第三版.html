<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows风格小组件</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0078D4',
                        secondary: '#0063B1',
                        accent: '#107C10',
                        neutral: '#333333',
                        'neutral-light': '#F3F2F1',
                        'neutral-dark': '#201F1E',
                        weather: {
                            sunny: '#FFC107',      // 晴天颜色
                            cloudy: '#607D8B',     // 多云颜色
                            rainy: '#2196F3',      // 雨天颜色
                            snowy: '#E0F7FA',      // 雪天颜色
                            foggy: '#9E9E9E',      // 雾天颜色
                        }
                    },
                    fontFamily: {
                        inter: ['Segoe UI', 'Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .widget-shadow {
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1);
            }
            .calendar-day {
                aspect-ratio: 1/1;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .news-gradient {
                background: linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.7) 100%);
            }
            .iframe-container {
                position: relative;
                overflow: hidden;
                width: 100%;
                height: 100%;
            }
            .responsive-iframe {
                position: absolute;
                top: 0;
                left: 0;
                bottom: 0;
                right: 0;
                width: 100%;
                height: 100%;
            }
            .full-height-widget {
                display: flex;
                flex-direction: column;
                height: 100%;
            }
            .tab-button {
                @apply px-4 py-2 text-sm font-medium transition-colors;
            }
            .tab-button.active {
                @apply bg-primary text-white;
            }
            .tab-button:not(.active) {
                @apply bg-gray-100 text-gray-700 hover:bg-gray-200;
            }
            .weather-card {
                @apply p-4 rounded-lg transition-all;
            }
            .weather-icon {
                @apply text-5xl mb-2;
            }
        }
    </style>
    <style>
        body {
            overflow: hidden; /* 隐藏浏览器的滚动条 */
        }
        /* 天气动画效果 */
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* 加载状态 */
        .loading-shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
    </style>
</head>
<body class="bg-gray-100 font-inter text-neutral">
    <div class="flex flex-col p-4 md:p-8">
        <!-- 合并的小组件 - 靠最上面，右边贴边，下面留出Windows菜单栏大小 -->
        <main class="absolute top-4 right-4 w-1/3 h-[calc(100vh-8rem)]">
            <section class="bg-white rounded-lg widget-shadow overflow-hidden transition-all hover:shadow-md full-height-widget">
                <!-- 切换按钮和返回按钮 -->
                <div class="flex border-b">
                    <button id="back-button" class="tab-button" onclick="goBack()">
                        <i class="fa fa-arrow-left mr-1"></i> 返回
                    </button>
                    <button id="calendar-tab" class="tab-button active" onclick="switchTab('calendar')">日历</button>
                    <button id="news-tab" class="tab-button" onclick="switchTab('news')">新闻</button>
                    <button id="weather-tab" class="tab-button" onclick="switchTab('weather')">天气</button>
                </div>
                
                <!-- 日历内容 -->
                <div id="calendar-content" class="iframe-container flex-1">
                    <iframe class="responsive-iframe" frameborder="0" src="https://rili-d.jin10.com/open.php?fontSize=14px&scrolling=yes&theme=primary"></iframe>
                </div>
                
                <!-- 新闻内容 -->
                <div id="news-content" class="iframe-container flex-1 hidden">
                    <iframe class="responsive-iframe" frameborder="0" src="https://www.jin10.com/example/jin10.com.html?fontSize=14px&theme=white"></iframe>
                </div>
                
                <!-- 天气内容 -->
                <div id="weather-content" class="flex-1 hidden p-4 overflow-auto">
                    <div id="weather-widget" class="weather-card bg-gradient-to-br from-blue-400 to-blue-600 text-white animate-fadeIn">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold">吴江天气</h3>
                            <div id="weather-update-time" class="text-sm opacity-80">加载中...</div>
                        </div>
                        
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <div id="weather-temp" class="text-5xl font-bold loading-shimmer">--°</div>
                                <div id="weather-desc" class="text-lg mt-1 loading-shimmer">--</div>
                            </div>
                            <div id="weather-icon" class="weather-icon loading-shimmer">
                                <i class="fa fa-sun-o"></i>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-2 text-center">
                            <div class="bg-white/20 p-2 rounded">
                                <i class="fa fa-tint mr-1"></i>
                                <span id="weather-humidity" class="loading-shimmer">--%</span>
                            </div>
                            <div class="bg-white/20 p-2 rounded">
                                <i class="fa fa-location-arrow mr-1"></i>
                                <span id="weather-wind" class="loading-shimmer">--</span>
                            </div>
                            <div class="bg-white/20 p-2 rounded">
                                <i class="fa fa-thermometer-half mr-1"></i>
                                <span id="weather-feels" class="loading-shimmer">--°</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 animate-fadeIn" style="animation-delay: 0.2s">
                        <h3 class="text-lg font-semibold mb-2">未来预报</h3>
                        <div id="weather-forecast" class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                            <!-- 未来天气将通过JavaScript动态填充 -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
    
    <script>
        // 切换标签页
        function switchTab(tabName) {
            // 隐藏所有内容
            document.getElementById('calendar-content').classList.add('hidden');
            document.getElementById('news-content').classList.add('hidden');
            document.getElementById('weather-content').classList.add('hidden');
            
            // 重置所有按钮样式
            document.getElementById('calendar-tab').classList.remove('active');
            document.getElementById('news-tab').classList.remove('active');
            document.getElementById('weather-tab').classList.remove('active');
            
            // 显示选中的内容和按钮样式
            document.getElementById(`${tabName}-content`).classList.remove('hidden');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // 如果切换到天气标签，加载天气数据
            if (tabName === 'weather') {
                resetWeatherUI(); // 重置UI显示加载状态
                fetchWeatherData();
            }
        }
        
        // 重置天气UI为加载状态
        function resetWeatherUI() {
            document.getElementById('weather-temp').classList.add('loading-shimmer');
            document.getElementById('weather-desc').classList.add('loading-shimmer');
            document.getElementById('weather-humidity').classList.add('loading-shimmer');
            document.getElementById('weather-wind').classList.add('loading-shimmer');
            document.getElementById('weather-feels').classList.add('loading-shimmer');
            document.getElementById('weather-icon').classList.add('loading-shimmer');
            document.getElementById('weather-update-time').textContent = '加载中...';
            
            // 清空预报区域
            document.getElementById('weather-forecast').innerHTML = '';
        }
        
        // 日期选择交互
        document.querySelectorAll('.calendar-day').forEach(day => {
            day.addEventListener('click', () => {
                // 移除其他日期的选中状态
                document.querySelectorAll('.calendar-day.bg-primary').forEach(selected => {
                    selected.classList.remove('bg-primary', 'text-white', 'rounded-full');
                });
                // 添加选中状态
                day.classList.add('bg-primary', 'text-white', 'rounded-full');
            });
        });
        
        // 监听窗口大小变化，调整iframe内容
        window.addEventListener('resize', adjustIframes);
        
        function adjustIframes() {
            const iframes = document.querySelectorAll('iframe');
            iframes.forEach(iframe => {
                try {
                    // 尝试获取iframe内部文档
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    
                    // 调整iframe内部字体大小
                    if (iframeDoc) {
                        const baseFontSize = Math.max(12, window.innerWidth / 100); // 基础字体大小，根据窗口宽度计算
                        iframeDoc.documentElement.style.fontSize = `${baseFontSize}px`;
                    }
                } catch (e) {
                    console.log('无法访问iframe内容:', e);
                }
            });
        }
        
        // 页面加载时初始化
        window.addEventListener('load', adjustIframes);

        // 返回上级网址
        function goBack() {
            window.history.back();
        }
        
        // 天气API相关
        function fetchWeatherData() {
            // 新的和风天气API密钥
            const apiKey = '4564b3b22a4c48d5a8cdf5321d7ff656';
            // 吴江区的locationID，可通过和风天气的城市搜索API获取
            const locationID = '101190408'; 
            
            console.log('开始获取天气数据...');
            
            // 获取当前天气
            fetch(`https://mf564trjbf.re.qweatherapi.com/v7/weather/now?location=${locationID}&key=${apiKey}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`API请求失败: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('当前天气数据:', data);
                    updateCurrentWeather(data);
                })
                .catch(error => {
                    console.error('获取当前天气失败:', error);
                    showWeatherError('获取当前天气失败');
                });
            
            // 获取未来天气预报
            fetch(`https://mf564trjbf.re.qweatherapi.com/v7/weather/3d?location=${locationID}&key=${apiKey}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`API请求失败: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('天气预报数据:', data);
                    updateWeatherForecast(data);
                })
                .catch(error => {
                    console.error('获取天气预报失败:', error);
                    showWeatherError('获取天气预报失败');
                });
        }
        
        // 显示天气错误信息
        function showWeatherError(message) {
            document.getElementById('weather-temp').textContent = '获取失败';
            document.getElementById('weather-desc').textContent = message;
            document.getElementById('weather-update-time').textContent = '更新失败';
            
            // 移除加载状态
            document.getElementById('weather-temp').classList.remove('loading-shimmer');
            document.getElementById('weather-desc').classList.remove('loading-shimmer');
            document.getElementById('weather-humidity').classList.remove('loading-shimmer');
            document.getElementById('weather-wind').classList.remove('loading-shimmer');
            document.getElementById('weather-feels').classList.remove('loading-shimmer');
            document.getElementById('weather-icon').classList.remove('loading-shimmer');
        }
        
        // 更新当前天气显示
        function updateCurrentWeather(data) {
            // 移除加载状态
            document.getElementById('weather-temp').classList.remove('loading-shimmer');
            document.getElementById('weather-desc').classList.remove('loading-shimmer');
            document.getElementById('weather-humidity').classList.remove('loading-shimmer');
            document.getElementById('weather-wind').classList.remove('loading-shimmer');
            document.getElementById('weather-feels').classList.remove('loading-shimmer');
            document.getElementById('weather-icon').classList.remove('loading-shimmer');
            
            if (!data || !data.now) {
                showWeatherError('数据格式错误');
                return;
            }
            
            const now = data.now;
            const updateTime = new Date(data.updateTime).toLocaleTimeString('zh-CN');
            
            document.getElementById('weather-temp').textContent = `${now.temp}°`;
            document.getElementById('weather-desc').textContent = now.text;
            document.getElementById('weather-humidity').textContent = `${now.humidity}%`;
            document.getElementById('weather-wind').textContent = `${now.windDir} ${now.windScale}级`;
            document.getElementById('weather-feels').textContent = `${now.feelsLike}°`;
            document.getElementById('weather-update-time').textContent = `更新于 ${updateTime}`;
            
            // 根据天气状况设置图标和背景
            setWeatherIcon(now.icon, document.getElementById('weather-icon'));
            
            // 根据天气状况设置背景颜色
            setWeatherBackground(now.icon);
        }
        
        // 更新天气预报显示
        function updateWeatherForecast(data) {
            const forecastContainer = document.getElementById('weather-forecast');
            forecastContainer.innerHTML = '';
            
            if (!data || !data.daily || data.daily.length === 0) {
                forecastContainer.innerHTML = '<div class="col-span-full text-center text-gray-500">暂无预报数据</div>';
                return;
            }
            
            // 只显示未来3天的预报
            const dailyForecast = data.daily.slice(0, 3);
            
            dailyForecast.forEach(day => {
                const date = new Date(day.fxDate);
                const dayName = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'][date.getDay()];
                
                const forecastItem = document.createElement('div');
                forecastItem.className = 'bg-white p-2 rounded-lg shadow-sm text-center';
                forecastItem.innerHTML = `
                    <div class="text-sm font-medium">${dayName}</div>
                    <div class="mt-1">
                        <i class="fa ${getWeatherIconClass(day.iconDay)} text-lg"></i>
                    </div>
                    <div class="mt-1 text-sm">${day.textDay}</div>
                    <div class="mt-1 text-xs text-gray-600">${day.tempMin}°~${day.tempMax}°</div>
                `;
                
                forecastContainer.appendChild(forecastItem);
            });
        }
        
        // 设置天气图标
        function setWeatherIcon(iconCode, element) {
            element.className = 'weather-icon';
            element.innerHTML = `<i class="fa ${getWeatherIconClass(iconCode)}"></i>`;
        }
        
        // 根据天气代码获取对应的Font Awesome图标类
        function getWeatherIconClass(iconCode) {
            // 和风天气图标代码对应表
            const iconMap = {
                '100': 'fa-sun-o',       // 晴
                '101': 'fa-cloud-sun-o', // 多云
                '102': 'fa-cloud',       // 少云
                '103': 'fa-cloud',       // 晴间多云
                '104': 'fa-cloud',       // 阴
                '200': 'fa-wind',        // 有风
                '201': 'fa-wind',        // 平静
                '202': 'fa-wind',        // 微风
                '203': 'fa-wind',        // 和风
                '204': 'fa-wind',        // 清风
                '205': 'fa-wind',        // 强风/劲风
                '206': 'fa-wind',        // 疾风
                '207': 'fa-wind',        // 大风
                '208': 'fa-wind',        // 烈风
                '209': 'fa-wind',        // 风暴
                '210': 'fa-wind',        // 狂风暴风
                '211': 'fa-bolt',        // 飓风
                '212': 'fa-bolt',        // 龙卷风
                '213': 'fa-bolt',        // 热带风暴
                '300': 'fa-tint',        // 小雨
                '301': 'fa-tint',        // 中雨
                '302': 'fa-tint',        // 大雨
                '303': 'fa-tint',        // 暴雨
                '304': 'fa-tint',        // 大暴雨
                '305': 'fa-tint',        // 特大暴雨
                '306': 'fa-tint',        // 阵雨
                '307': 'fa-tint',        // 雷阵雨
                '308': 'fa-tint',        // 雷阵雨伴有冰雹
                '309': 'fa-tint',        // 冻雨
                '310': 'fa-tint',        // 小雨-中雨
                '311': 'fa-tint',        // 中雨-大雨
                '312': 'fa-tint',        // 大雨-暴雨
                '313': 'fa-tint',        // 暴雨-大暴雨
                '314': 'fa-tint',        // 大暴雨-特大暴雨
                '315': 'fa-tint',        // 毛毛雨/细雨
                '400': 'fa-snowflake-o', // 小雪
                '401': 'fa-snowflake-o', // 中雪
                '402': 'fa-snowflake-o', // 大雪
                '403': 'fa-snowflake-o', // 暴雪
                '404': 'fa-snowflake-o', // 雨夹雪
                '405': 'fa-snowflake-o', // 小雪-中雪
                '406': 'fa-snowflake-o', // 中雪-大雪
                '407': 'fa-snowflake-o', // 大雪-暴雪
                '500': 'fa-cloud',       // 雾
                '501': 'fa-cloud',       // 轻雾/霭
                '502': 'fa-cloud',       // 浓雾
                '503': 'fa-cloud',       // 强浓雾
                '504': 'fa-cloud',       // 雾
                '507': 'fa-cloud',       // 薄雾
                '508': 'fa-cloud',       // 冻雾
                '600': 'fa-smog',        // 沙尘暴
                '601': 'fa-smog',        // 扬沙
                '602': 'fa-smog',        // 浮尘
                '603': 'fa-smog',        // 沙尘
                '604': 'fa-smog',        // 强沙尘暴
                '900': 'fa-exclamation-triangle', // 热
                '901': 'fa-exclamation-triangle', // 冷
                '999': 'fa-question-circle'       // 未知
            };
            
            return iconMap[iconCode] || 'fa-question-circle';
        }
        
        // 根据天气状况设置背景颜色
        function setWeatherBackground(iconCode) {
            const weatherWidget = document.getElementById('weather-widget');
            
            // 根据天气代码判断天气类型
            if (iconCode.startsWith('1')) {
                // 晴天或多云
                weatherWidget.className = 'weather-card bg-gradient-to-br from-blue-400 to-blue-600 text-white animate-fadeIn';
            } else if (iconCode.startsWith('3')) {
                // 雨天
                weatherWidget.className = 'weather-card bg-gradient-to-br from-blue-600 to-blue-800 text-white animate-fadeIn';
            } else if (iconCode.startsWith('4')) {
                // 雪天
                weatherWidget.className = 'weather-card bg-gradient-to-br from-blue-300 to-blue-500 text-white animate-fadeIn';
            } else if (iconCode.startsWith('5') || iconCode.startsWith('6')) {
                // 雾天或沙尘
                weatherWidget.className = 'weather-card bg-gradient-to-br from-gray-400 to-gray-600 text-white animate-fadeIn';
            } else {
                // 其他天气
                weatherWidget.className = 'weather-card bg-gradient-to-br from-blue-400 to-blue-600 text-white animate-fadeIn';
            }
        }
    </script>
</body>
</html>
